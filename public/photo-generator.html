<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>HelloComp Photo Post Factory v5.3 PRO × Heureka</title>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap");

        :root {
            --brand: #2166CC;
            --brand-light: #4d8ee8;
            --accent: #00d4ff;
            --neon-purple: #a855f7;
            --success: #10b981;
            --text: #f0f2f5;
            --muted: #8b95a5;
            --surface: #0c0f14;
            --panel-bg: rgba(8, 10, 16, .94);
            --stroke: rgba(255, 255, 255, .1)
        }

        * {
            box-sizing: border-box;
            margin: 0
        }

        body {
            font-family: "Inter", system-ui, -apple-system, sans-serif;
            background: #070a0e;
            color: var(--text);
            height: 100vh;
            overflow: hidden
        }

        .app {
            display: grid;
            grid-template-columns: 360px 1fr;
            height: 100%
        }

        .panel {
            background: var(--panel-bg);
            border-right: 1px solid var(--stroke);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            padding: 14px;
            gap: 8px;
            overflow-y: auto
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--stroke)
        }

        .panel-header .logo-img {
            height: 22px;
            width: auto;
            filter: brightness(0) invert(1);
            opacity: .9
        }

        .panel-header .version {
            font-size: 10px;
            color: var(--accent);
            margin-left: auto;
            background: linear-gradient(135deg, rgba(0, 212, 255, .12), rgba(168, 85, 247, .12));
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid rgba(0, 212, 255, .2);
            font-weight: 800;
            letter-spacing: .05em;
            animation: versionGlow 3s ease-in-out infinite
        }

        .section-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: .08em;
            margin-top: 4px
        }

        .btn-row {
            display: flex;
            gap: 6px;
            flex-wrap: wrap
        }

        .btn {
            border: 1px solid rgba(255, 255, 255, .15);
            background: linear-gradient(135deg, var(--brand), rgba(33, 102, 204, .7));
            color: #fff;
            border-radius: 8px;
            padding: 7px 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: .03em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all .15s;
            font-family: inherit
        }

        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-1px)
        }

        .btn:active {
            transform: translateY(0)
        }

        .btn.secondary {
            background: rgba(255, 255, 255, .07);
            color: #c8d0dc
        }

        .btn.success {
            background: linear-gradient(135deg, #059669, #10b981)
        }

        .btn.export {
            background: linear-gradient(135deg, #7c3aed, #a855f7);
            position: relative;
            overflow: hidden
        }

        .btn.export::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 40%;
            height: 200%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .2), transparent);
            transform: skewX(-25deg);
            animation: btnShine 3s ease-in-out infinite
        }

        .btn.small {
            padding: 5px 8px;
            font-size: 10px
        }

        input.field,
        select.field {
            width: 100%;
            border: 1px solid var(--stroke);
            background: rgba(0, 0, 0, .4);
            color: var(--text);
            border-radius: 8px;
            padding: 7px 10px;
            font-size: 11px;
            font-family: inherit;
            outline: none
        }

        input.field:focus,
        select.field:focus {
            border-color: var(--brand)
        }

        textarea.field {
            width: 100%;
            flex: 1;
            min-height: 80px;
            resize: none;
            border: 1px solid var(--stroke);
            background: rgba(0, 0, 0, .4);
            color: #dde3ed;
            border-radius: 8px;
            padding: 8px;
            font-family: "SF Mono", ui-monospace, monospace;
            font-size: 10px;
            line-height: 1.4;
            outline: none
        }

        textarea.field:focus {
            border-color: var(--brand)
        }

        .status-bar {
            font-size: 11px;
            color: var(--muted);
            padding: 4px 0;
            min-height: 1.4em
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: .5
            }
        }

        @keyframes cardEntrance {
            from {
                opacity: 0;
                transform: translateY(40px) scale(.95)
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1)
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(.85)
            }

            to {
                opacity: 1;
                transform: scale(1)
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200% center
            }

            100% {
                background-position: 200% center
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-8px)
            }
        }

        @keyframes glowPulse {

            0%,
            100% {
                opacity: .6;
                transform: translateX(-50%) scale(1)
            }

            50% {
                opacity: 1;
                transform: translateX(-50%) scale(1.08)
            }
        }

        @keyframes btnShine {
            0% {
                left: -60%
            }

            30%,
            100% {
                left: 120%
            }
        }

        @keyframes specSlide {
            from {
                opacity: 0;
                transform: translateX(-16px)
            }

            to {
                opacity: 1;
                transform: translateX(0)
            }
        }

        @keyframes versionGlow {

            0%,
            100% {
                box-shadow: 0 0 0 rgba(0, 212, 255, 0)
            }

            50% {
                box-shadow: 0 0 12px rgba(0, 212, 255, .3)
            }
        }

        @keyframes gradientMove {
            0% {
                background-position: 0% 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0% 50%
            }
        }

        @keyframes priceReveal {
            from {
                opacity: 0;
                transform: translateY(8px) scale(.9);
                filter: blur(4px)
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0)
            }
        }

        @keyframes ctaPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(33, 102, 204, .4)
            }

            50% {
                box-shadow: 0 0 0 6px rgba(33, 102, 204, 0)
            }
        }

        @keyframes neonCtaPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(0, 212, 255, .4)
            }

            50% {
                box-shadow: 0 0 0 8px rgba(0, 212, 255, 0)
            }
        }

        @keyframes dotFloat {
            0% {
                transform: translateY(0) scale(1);
                opacity: .7
            }

            50% {
                opacity: 1
            }

            100% {
                transform: translateY(-180px) scale(0);
                opacity: 0
            }
        }

        /* ─── v5 FUSION: New Keyframes ─── */
        @keyframes scanLine {
            0% {
                top: -2px
            }

            100% {
                top: 100%
            }
        }

        @keyframes holoShimmer {
            0% {
                background-position: -200% 0
            }

            100% {
                background-position: 200% 0
            }
        }

        @keyframes energyFill {
            from {
                width: 0;
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        @keyframes urgencyPulse {

            0%,
            100% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.05)
            }
        }

        @keyframes borderGlow {

            0%,
            100% {
                border-color: rgba(0, 212, 255, .15)
            }

            50% {
                border-color: rgba(0, 212, 255, .4)
            }
        }

        @keyframes dataStream {
            0% {
                background-position: 0 0
            }

            100% {
                background-position: 0 -200px
            }
        }

        /* ─── v5 FUSION: Cyber Grid Overlay ─── */
        .cyber-grid::after {
            content: '';
            position: absolute;
            inset: 0;
            background:
                linear-gradient(rgba(0, 212, 255, .03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, .03) 1px, transparent 1px);
            background-size: 24px 24px;
            pointer-events: none;
            z-index: 1;
            mask-image: linear-gradient(to bottom, transparent 10%, rgba(0, 0, 0, .3) 50%, transparent 90%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 10%, rgba(0, 0, 0, .3) 50%, transparent 90%)
        }

        /* ─── v5: Scanner Line (futuristic sweep) ─── */
        .scanner-line::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            box-shadow: 0 0 12px var(--accent), 0 0 24px rgba(0, 212, 255, .3);
            z-index: 10;
            animation: scanLine 4s linear infinite;
            opacity: .5
        }

        /* ─── v5: Holographic Shimmer (premium cards) ─── */
        .holo-shimmer::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(105deg,
                    transparent 30%,
                    rgba(0, 212, 255, .06) 38%,
                    rgba(168, 85, 247, .06) 42%,
                    rgba(0, 212, 255, .06) 46%,
                    transparent 54%);
            background-size: 200% 100%;
            animation: holoShimmer 3s linear infinite;
            pointer-events: none;
            z-index: 5;
            border-radius: 18px
        }

        /* ─── v5: Lineup Badge ─── */
        .lineup-badge {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            font-size: 8px;
            font-weight: 900;
            letter-spacing: .1em;
            text-transform: uppercase;
            padding: 3px 10px;
            border-radius: 999px;
            backdrop-filter: blur(8px);
            white-space: nowrap
        }

        .lineup-badge.se {
            background: rgba(33, 102, 204, .2);
            color: var(--brand-light);
            border: 1px solid rgba(33, 102, 204, .3)
        }

        .lineup-badge.pro {
            background: rgba(168, 85, 247, .2);
            color: #c084fc;
            border: 1px solid rgba(168, 85, 247, .3);
            animation: borderGlow 2s ease-in-out infinite
        }

        .lineup-badge.max {
            background: linear-gradient(135deg, rgba(234, 179, 8, .2), rgba(249, 115, 22, .2));
            color: #fbbf24;
            border: 1px solid rgba(234, 179, 8, .3);
            text-shadow: 0 0 8px rgba(234, 179, 8, .3)
        }

        /* ─── v5: GPU Brand Badge ─── */
        .gpu-badge {
            font-size: 8px;
            font-weight: 800;
            padding: 2px 7px;
            border-radius: 4px;
            letter-spacing: .04em;
            text-transform: uppercase;
            display: inline-block
        }

        .gpu-badge.nvidia {
            background: rgba(118, 185, 0, .15);
            color: #76b900;
            border: 1px solid rgba(118, 185, 0, .2)
        }

        .gpu-badge.amd {
            background: rgba(237, 28, 36, .15);
            color: #ff4444;
            border: 1px solid rgba(237, 28, 36, .2)
        }

        /* ─── v5: Urgency Pill ─── */
        .urgency-pill {
            font-size: 9px;
            font-weight: 800;
            padding: 3px 8px;
            border-radius: 999px;
            background: rgba(239, 68, 68, .15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, .2);
            text-transform: uppercase;
            letter-spacing: .04em;
            animation: urgencyPulse 2s ease-in-out infinite;
            display: inline-block
        }

        .urgency-pill.hot {
            background: linear-gradient(135deg, rgba(239, 68, 68, .2), rgba(249, 115, 22, .2));
            color: #fb923c;
            border-color: rgba(249, 115, 22, .3)
        }

        /* ─── v5: Social Proof ─── */
        .social-proof {
            font-size: 9px;
            color: var(--muted);
            display: flex;
            align-items: center;
            gap: 4px
        }

        .social-proof .dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--success);
            display: inline-block
        }

        /* ─── v5: Energy Meter (spec bars) ─── */
        .energy-meter {
            display: flex;
            flex-direction: column;
            gap: 6px
        }

        .energy-row {
            display: flex;
            align-items: center;
            gap: 8px
        }

        .energy-label {
            font-size: 8px;
            font-weight: 800;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: .06em;
            width: 48px;
            flex-shrink: 0
        }

        .energy-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, .06);
            border-radius: 3px;
            overflow: hidden;
            position: relative
        }

        .energy-fill {
            height: 100%;
            border-radius: 3px;
            animation: energyFill .8s ease both;
            position: relative
        }

        .energy-fill::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent 60%, rgba(255, 255, 255, .3));
            border-radius: 3px
        }

        .energy-fill.gpu {
            background: linear-gradient(90deg, #76b900, #00d4ff)
        }

        .energy-fill.cpu {
            background: linear-gradient(90deg, var(--brand), var(--brand-light))
        }

        .energy-fill.ram {
            background: linear-gradient(90deg, #a855f7, #c084fc)
        }

        .energy-fill.storage {
            background: linear-gradient(90deg, #10b981, #34d399)
        }

        .energy-value {
            font-size: 9px;
            font-weight: 700;
            color: var(--text);
            width: 70px;
            flex-shrink: 0;
            text-align: right;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        /* ─── v5: Category Tag ─── */
        .category-tag {
            font-size: 8px;
            font-weight: 700;
            color: rgba(255, 255, 255, .4);
            text-transform: uppercase;
            letter-spacing: .06em;
            padding: 2px 6px;
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 4px;
            display: inline-block
        }

        .category-tag.light {
            color: rgba(0, 0, 0, .35);
            border-color: rgba(0, 0, 0, .08)
        }

        /* ─── v5: Data Stream BG for dark templates ─── */
        .data-stream {
            position: absolute;
            inset: 0;
            opacity: .03;
            background: repeating-linear-gradient(0deg,
                    transparent 0px,
                    transparent 18px,
                    rgba(0, 212, 255, .5) 18px,
                    rgba(0, 212, 255, .5) 19px);
            animation: dataStream 8s linear infinite;
            pointer-events: none;
            z-index: 0
        }

        .template-chips {
            display: flex;
            gap: 4px;
            flex-wrap: wrap
        }

        .chip {
            font-size: 10px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid var(--stroke);
            background: rgba(255, 255, 255, .04);
            color: var(--muted);
            cursor: pointer;
            transition: all .15s;
            text-transform: uppercase;
            letter-spacing: .04em
        }

        .chip:hover {
            background: rgba(255, 255, 255, .08);
            color: var(--text)
        }

        .chip.active {
            background: var(--brand);
            color: #fff;
            border-color: var(--brand)
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 4px 0
        }

        .collapsible-body {
            overflow: hidden;
            transition: max-height .3s
        }

        .collapsible-body.collapsed {
            max-height: 0 !important
        }

        .auto-bg-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px
        }

        .auto-bg-row label {
            font-size: 10px;
            color: var(--muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px
        }

        .auto-bg-row input[type=checkbox] {
            accent-color: var(--brand)
        }

        .preview {
            overflow: auto;
            padding: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-content: flex-start;
            background: radial-gradient(ellipse at 30% 20%, #111827, #070a0e 70%)
        }

        .preview-count {
            position: sticky;
            top: 0;
            width: 100%;
            padding: 8px 12px;
            background: rgba(7, 10, 14, .9);
            backdrop-filter: blur(8px);
            border-radius: 10px;
            border: 1px solid var(--stroke);
            font-size: 11px;
            color: var(--muted);
            z-index: 5;
            display: flex;
            gap: 12px;
            align-items: center
        }

        .preview-count strong {
            color: var(--text)
        }

        .card {
            width: 324px;
            aspect-ratio: 9/16;
            border-radius: 18px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            transition: transform .3s cubic-bezier(.4, 0, .2, 1), box-shadow .3s;
            animation: cardEntrance .6s cubic-bezier(.16, 1, .3, 1) both;
            will-change: transform, opacity
        }

        .card:hover {
            transform: scale(1.03) translateY(-4px);
            box-shadow: 0 24px 48px rgba(0, 0, 0, .4)
        }

        .card .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 20;
            background: rgba(33, 102, 204, .85);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, .25);
            color: #fff;
            font-size: 9px;
            font-weight: 800;
            letter-spacing: .04em;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer
        }

        .card .remove-btn:hover {
            background: rgba(33, 102, 204, 1)
        }

        .card .bg-btn {
            right: 52px;
            background: rgba(16, 185, 129, .85);
            font-size: 8px;
            letter-spacing: .06em
        }

        .card .bg-btn:hover {
            background: rgba(16, 185, 129, 1)
        }

        .card .bg-btn.done {
            background: rgba(16, 185, 129, .3);
            pointer-events: none
        }

        .card .bg-btn.working {
            background: rgba(0, 212, 255, .6);
            pointer-events: none;
            animation: pulse 1s infinite
        }

        .bg-progress {
            font-size: 10px;
            font-weight: 700;
            color: var(--accent);
            padding: 4px 0;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .bg-progress .bar {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,.08);
            border-radius: 2px;
            overflow: hidden
        }

        .bg-progress .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--neon-purple));
            border-radius: 2px;
            transition: width .3s
        }

        .card .template-label {
            position: absolute;
            top: 8px;
            left: 8px;
            z-index: 20;
            font-size: 8px;
            font-weight: 800;
            letter-spacing: .06em;
            text-transform: uppercase;
            padding: 3px 6px;
            border-radius: 4px;
            background: rgba(0, 0, 0, .5);
            color: rgba(255, 255, 255, .5);
            backdrop-filter: blur(4px)
        }

        .card .logo-watermark {
            height: 18px;
            width: auto;
            opacity: .7
        }

        .card .product-img {
            display: block;
            max-height: 100%;
            max-width: 90%;
            width: auto;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 12px 32px rgba(0, 0, 0, .3));
            animation: scaleIn .5s cubic-bezier(.16, 1, .3, 1) .15s both;
            transition: transform .4s cubic-bezier(.4, 0, .2, 1), filter .4s;
            /* Instant visual BG removal for white-bg product photos on dark cards */
            mix-blend-mode: multiply
        }

        .card .product-img.bg-removed {
            mix-blend-mode: normal /* Reset after actual BG removal */
        }

        .card:hover .product-img {
            transform: scale(1.04);
            filter: drop-shadow(0 16px 40px rgba(0, 0, 0, .4))
        }

        .card .content {
            animation: slideUp .5s cubic-bezier(.16, 1, .3, 1) .2s both
        }

        /* === HERO === */
        .tpl-hero {
            background: linear-gradient(170deg, #0f1628 0%, #080d18 40%, #04070d 100%);
            border: 1px solid rgba(255, 255, 255, .08);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .6)
        }

        .tpl-hero::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: 18px;
            padding: 1px;
            background: linear-gradient(170deg, rgba(33, 102, 204, .3), transparent 40%, rgba(0, 212, 255, .15));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 1
        }

        .tpl-hero:hover {
            box-shadow: 0 24px 64px rgba(33, 102, 204, .15), 0 20px 60px rgba(0, 0, 0, .6)
        }

        .tpl-hero .product-zone {
            position: absolute;
            top: 5%;
            left: 0;
            right: 0;
            height: 52%;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .tpl-hero .product-img {
            filter: drop-shadow(0 16px 40px rgba(33, 102, 204, .2)) drop-shadow(0 4px 12px rgba(0, 0, 0, .4))
        }

        .tpl-hero .content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: linear-gradient(to top, rgba(4, 7, 13, .98) 0%, rgba(8, 13, 24, .85) 60%, transparent 100%)
        }

        .tpl-hero .logo-row {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .tpl-hero .stock-pill {
            background: rgba(16, 185, 129, .15);
            color: #34d399;
            font-size: 9px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 999px;
            text-transform: uppercase;
            letter-spacing: .05em
        }

        .tpl-hero .hook {
            font-size: 24px;
            font-weight: 900;
            line-height: 1;
            letter-spacing: -.02em;
            text-transform: uppercase;
            animation: slideUp .4s ease .3s both
        }

        .tpl-hero .name {
            font-size: 11px;
            color: #8b9ab5;
            font-weight: 600
        }

        .tpl-hero .specs-line {
            font-size: 10px;
            color: #6b7a92;
            margin-top: 2px
        }

        .tpl-hero .price-row {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-top: 4px
        }

        .tpl-hero .price {
            font-size: 30px;
            font-weight: 900;
            letter-spacing: -.02em;
            animation: priceReveal .5s ease .5s both;
            background: linear-gradient(90deg, #fff 40%, var(--accent) 50%, #fff 60%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: priceReveal .5s ease .5s both, shimmer 4s linear 1s infinite
        }

        .tpl-hero .cta-btn {
            background: var(--brand);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            letter-spacing: .04em;
            text-transform: uppercase;
            padding: 10px 16px;
            text-align: center;
            animation: slideUp .4s ease .6s both, ctaPulse 2.5s ease 1.5s infinite;
            transition: transform .2s, filter .2s
        }

        .tpl-hero .cta-btn:hover {
            transform: scale(1.03);
            filter: brightness(1.15)
        }

        /* === SPLIT === */
        .tpl-split {
            background: #f5f7fa;
            border: 1px solid rgba(0, 0, 0, .06);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .15)
        }

        .tpl-split .product-zone {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(160deg, #edf0f5, #f8f9fb);
            display: flex;
            align-items: center;
            justify-content: center
        }

        .tpl-split .product-img {
            filter: drop-shadow(0 8px 24px rgba(0, 0, 0, .12))
        }

        .tpl-split .content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            background: #fff
        }

        .tpl-split .logo-row {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .tpl-split .logo-watermark {
            filter: none;
            opacity: .8
        }

        .tpl-split .stock-pill {
            background: #111827;
            color: #fff;
            font-size: 9px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .tpl-split .divider {
            width: 40px;
            height: 3px;
            background: var(--brand);
            border-radius: 2px
        }

        .tpl-split .hook {
            font-size: 22px;
            font-weight: 900;
            line-height: 1.05;
            color: #111827;
            text-transform: uppercase;
            letter-spacing: -.01em;
            animation: slideUp .4s ease .3s both
        }

        .tpl-split .name {
            font-size: 11px;
            color: #6b7280;
            font-weight: 600
        }

        .tpl-split .specs-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 2px
        }

        .tpl-split .spec-tag {
            font-size: 9px;
            font-weight: 700;
            color: #4b5563;
            background: #f3f4f6;
            padding: 3px 8px;
            border-radius: 6px;
            border: 1px solid #e5e7eb
        }

        .tpl-split .price-row {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-top: auto
        }

        .tpl-split .price {
            font-size: 28px;
            font-weight: 900;
            color: #111827;
            letter-spacing: -.02em;
            animation: priceReveal .5s ease .5s both
        }

        .tpl-split .cta-btn {
            background: #111827;
            color: #fff;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: .04em;
            padding: 10px 16px;
            text-align: center;
            animation: slideUp .4s ease .6s both;
            transition: transform .2s, box-shadow .2s
        }

        .tpl-split .cta-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 24px rgba(0, 0, 0, .15)
        }

        /* === MINIMAL === */
        .tpl-minimal {
            background: #f5f7fa;
            border: 1px solid rgba(0, 0, 0, .06);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .15)
        }

        .tpl-minimal .product-zone {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 55%;
            background: linear-gradient(180deg, #ffffff, #f0f2f6);
            display: flex;
            align-items: center;
            justify-content: center
        }

        .tpl-minimal .product-img {
            filter: drop-shadow(0 12px 32px rgba(0, 0, 0, .12))
        }

        .tpl-minimal .content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 45%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 6px
        }

        .tpl-minimal .logo-row {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .tpl-minimal .logo-watermark {
            filter: none;
            opacity: .7
        }

        .tpl-minimal .stock-tag {
            background: var(--success);
            color: #fff;
            font-size: 9px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .tpl-minimal .claim {
            font-size: 10px;
            font-weight: 700;
            color: var(--brand);
            text-transform: uppercase;
            letter-spacing: .06em
        }

        .tpl-minimal .hook {
            font-size: 21px;
            font-weight: 900;
            line-height: 1.05;
            color: #111827;
            text-transform: uppercase;
            letter-spacing: -.01em
        }

        .tpl-minimal .name {
            font-size: 11px;
            color: #6b7280;
            font-weight: 600
        }

        .tpl-minimal .specs-line {
            font-size: 10px;
            color: #9ca3af
        }

        .tpl-minimal .price-row {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-top: auto
        }

        .tpl-minimal .price {
            font-size: 28px;
            font-weight: 900;
            color: #111827;
            letter-spacing: -.02em;
            animation: priceReveal .5s ease .5s both
        }

        .tpl-minimal .cta-btn {
            background: #111827;
            color: #fff;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            padding: 10px 14px;
            text-transform: uppercase;
            letter-spacing: .04em;
            animation: slideUp .4s ease .6s both;
            transition: transform .2s
        }

        .tpl-minimal .cta-btn:hover {
            transform: scale(1.03)
        }

        /* === NEON === */
        .tpl-neon {
            background: radial-gradient(ellipse at 50% 30%, #0d1220, #05080e 70%);
            border: 1px solid rgba(0, 212, 255, .12);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .6), 0 0 80px rgba(0, 212, 255, .05)
        }

        .tpl-neon .glow-ring {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 212, 255, .12), rgba(168, 85, 247, .06), transparent 70%);
            pointer-events: none;
            animation: glowPulse 3s ease-in-out infinite
        }

        .tpl-neon .particles {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 1
        }

        .tpl-neon .particle {
            position: absolute;
            bottom: -10px;
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background: var(--accent);
            animation: dotFloat linear infinite;
            opacity: 0
        }

        .tpl-neon .product-zone {
            position: absolute;
            top: 3%;
            left: 0;
            right: 0;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2
        }

        .tpl-neon .product-img {
            filter: drop-shadow(0 0 30px rgba(0, 212, 255, .15)) drop-shadow(0 12px 32px rgba(0, 0, 0, .5));
            animation: scaleIn .5s cubic-bezier(.16, 1, .3, 1) .15s both, float 4s ease-in-out .8s infinite
        }

        .tpl-neon:hover .product-img {
            filter: drop-shadow(0 0 40px rgba(0, 212, 255, .25)) drop-shadow(0 16px 40px rgba(0, 0, 0, .5))
        }

        .tpl-neon .content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: linear-gradient(to top, rgba(5, 8, 14, .98) 0%, rgba(5, 8, 14, .8) 60%, transparent 100%);
            z-index: 3
        }

        .tpl-neon .logo-row {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .tpl-neon .logo-watermark {
            filter: brightness(0) invert(1);
            opacity: .6
        }

        .tpl-neon .stock-pill {
            background: rgba(0, 212, 255, .12);
            color: var(--accent);
            font-size: 9px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .tpl-neon .claim {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .08em;
            background: linear-gradient(90deg, var(--accent), var(--neon-purple), var(--accent));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite
        }

        .tpl-neon .hook {
            font-size: 26px;
            font-weight: 900;
            line-height: .95;
            text-transform: uppercase;
            letter-spacing: -.02em;
            animation: slideUp .4s ease .35s both
        }

        .tpl-neon .name {
            font-size: 11px;
            color: #6b7a92;
            font-weight: 600
        }

        .tpl-neon .specs-line {
            font-size: 10px;
            color: #4a5568
        }

        .tpl-neon .price {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -.02em;
            background: linear-gradient(90deg, #fff 30%, var(--accent) 50%, #fff 70%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: priceReveal .5s ease .5s both, shimmer 3s linear 1.2s infinite
        }

        .tpl-neon .cta-btn {
            background: linear-gradient(135deg, var(--accent), var(--neon-purple));
            color: #fff;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: .04em;
            padding: 10px 16px;
            text-align: center;
            animation: slideUp .4s ease .6s both, neonCtaPulse 2.5s ease 1.5s infinite;
            transition: transform .2s, filter .2s
        }

        .tpl-neon .cta-btn:hover {
            transform: scale(1.03);
            filter: brightness(1.15)
        }

        /* === SPECS === */
        .tpl-specs {
            background: linear-gradient(170deg, #111827 0%, #0b0f1a 100%);
            border: 1px solid rgba(255, 255, 255, .08);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .5)
        }

        .tpl-specs .product-zone {
            position: absolute;
            top: 2%;
            left: 0;
            right: 0;
            height: 38%;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .tpl-specs .product-img {
            filter: drop-shadow(0 8px 24px rgba(0, 0, 0, .4))
        }

        .tpl-specs .content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 62%;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: linear-gradient(to top, #0b0f1a, #0b0f1a 80%, transparent)
        }

        .tpl-specs .logo-row {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .tpl-specs .stock-pill {
            background: rgba(16, 185, 129, .15);
            color: #34d399;
            font-size: 9px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .tpl-specs .hook {
            font-size: 18px;
            font-weight: 900;
            line-height: 1.1;
            text-transform: uppercase
        }

        .tpl-specs .name {
            font-size: 10px;
            color: #6b7a92;
            font-weight: 600
        }

        .tpl-specs .specs-table {
            display: flex;
            flex-direction: column;
            gap: 5px
        }

        .tpl-specs .spec-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 10px;
            animation: specSlide .4s ease both;
            transition: background .2s, border-color .2s
        }

        .tpl-specs .spec-row:nth-child(1) {
            animation-delay: .3s
        }

        .tpl-specs .spec-row:nth-child(2) {
            animation-delay: .4s
        }

        .tpl-specs .spec-row:nth-child(3) {
            animation-delay: .5s
        }

        .tpl-specs .spec-row:hover {
            background: rgba(33, 102, 204, .08);
            border-color: rgba(33, 102, 204, .2)
        }

        .tpl-specs .spec-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: rgba(33, 102, 204, .15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            flex-shrink: 0
        }

        .tpl-specs .spec-label {
            font-size: 9px;
            color: #4a5568;
            text-transform: uppercase;
            letter-spacing: .05em;
            font-weight: 700
        }

        .tpl-specs .spec-value {
            font-size: 12px;
            font-weight: 700;
            color: #e2e8f0
        }

        .tpl-specs .price-row {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-top: auto
        }

        .tpl-specs .price {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -.02em
        }

        .tpl-specs .cta-btn {
            background: var(--brand);
            color: #fff;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            padding: 10px 14px;
            text-transform: uppercase;
            letter-spacing: .04em;
            animation: slideUp .4s ease .7s both, ctaPulse 2.5s ease 1.5s infinite;
            transition: transform .2s
        }

        .tpl-specs .cta-btn:hover {
            transform: scale(1.03)
        }

        /* === v5.3 PRO: Card Selection === */
        .card { cursor: pointer }
        .card.selected {
            outline: 3px solid var(--accent);
            outline-offset: -3px;
            box-shadow: 0 0 24px rgba(0, 212, 255, .3), 0 20px 60px rgba(0, 0, 0, .6)
        }
        .card .select-check {
            position: absolute;
            bottom: 8px;
            right: 8px;
            z-index: 25;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,.2);
            background: rgba(0,0,0,.4);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: transparent;
            transition: all .2s;
            pointer-events: none
        }
        .card.selected .select-check {
            background: var(--accent);
            border-color: var(--accent);
            color: #000;
            box-shadow: 0 0 12px rgba(0, 212, 255, .5)
        }

        /* === v5.3 PRO: CS2 (Counter-Strike) Style === */
        .tpl-csgo {
            background: linear-gradient(160deg, #1a1f1a 0%, #0d1210 40%, #0a0e0c 100%);
            border: 1px solid rgba(134, 169, 82, .15);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .7)
        }
        .tpl-csgo .rarity-stripe {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            z-index: 10
        }
        .tpl-csgo .rarity-stripe.covert { background: #eb4b4b }
        .tpl-csgo .rarity-stripe.classified { background: #d32ce6 }
        .tpl-csgo .rarity-stripe.restricted { background: #8847ff }
        .tpl-csgo .wear-tag {
            font-size: 7px;
            font-weight: 800;
            color: rgba(134, 169, 82, .7);
            text-transform: uppercase;
            letter-spacing: .1em;
            padding: 2px 6px;
            border: 1px solid rgba(134, 169, 82, .15);
            border-radius: 3px;
            display: inline-block
        }
        .tpl-csgo .hook { color: #86a952 }
        .tpl-csgo .price { color: #86a952 }
        .tpl-csgo .name { color: #c5d6a0 }
        .tpl-csgo .cta-btn {
            background: linear-gradient(135deg, #4a7a2e, #86a952);
            color: #0d1210;
            font-weight: 900
        }
        .tpl-csgo .product-zone { background: radial-gradient(ellipse at center 40%, rgba(134,169,82,.06), transparent 70%) }

        /* === v5.3 PRO: League of Legends Style === */
        .tpl-lol {
            background: linear-gradient(170deg, #0a1628 0%, #091020 40%, #05091a 100%);
            border: 1px solid rgba(200, 170, 80, .2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .7)
        }
        .tpl-lol::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: 18px;
            padding: 1px;
            background: linear-gradient(170deg, rgba(200, 170, 80, .4), transparent 30%, transparent 70%, rgba(200, 170, 80, .2));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 1
        }
        .tpl-lol .rank-frame {
            position: absolute;
            top: 38%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px;
            height: 160px;
            border: 2px solid rgba(200, 170, 80, .12);
            border-radius: 50%;
            z-index: 0;
            box-shadow: 0 0 40px rgba(200, 170, 80, .06), inset 0 0 30px rgba(200, 170, 80, .04)
        }
        .tpl-lol .rank-tag {
            font-size: 8px;
            font-weight: 900;
            color: #c8aa50;
            text-transform: uppercase;
            letter-spacing: .12em;
            padding: 3px 10px;
            border: 1px solid rgba(200, 170, 80, .25);
            border-radius: 999px;
            display: inline-block;
            text-shadow: 0 0 8px rgba(200, 170, 80, .3)
        }
        .tpl-lol .hook { color: #c8aa50; text-shadow: 0 0 12px rgba(200, 170, 80, .3) }
        .tpl-lol .price { color: #c8aa50; text-shadow: 0 0 8px rgba(200, 170, 80, .2) }
        .tpl-lol .name { color: #e8dcc0 }
        .tpl-lol .cta-btn {
            background: linear-gradient(135deg, #785a28, #c8aa50);
            color: #0a0c10;
            font-weight: 900
        }
        .tpl-lol .product-zone { background: radial-gradient(ellipse at center 40%, rgba(200,170,80,.05), transparent 70%) }

        /* === v5.3 PRO: Fortnite Style === */
        .tpl-fortnite {
            background: linear-gradient(160deg, #1a0a3e 0%, #0f0628 40%, #0a0420 100%);
            border: 1px solid rgba(147, 100, 255, .2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, .7)
        }
        .tpl-fortnite .diagonal-stripes {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(-45deg, transparent, transparent 20px, rgba(147,100,255,.03) 20px, rgba(147,100,255,.03) 22px);
            pointer-events: none;
            z-index: 1;
            border-radius: 18px
        }
        .tpl-fortnite .rarity-glow {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 120px;
            background: radial-gradient(ellipse, rgba(147,100,255,.12), transparent);
            pointer-events: none;
            z-index: 0
        }
        .tpl-fortnite .item-rarity {
            font-size: 8px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: .12em;
            padding: 3px 10px;
            border-radius: 4px;
            display: inline-block
        }
        .tpl-fortnite .item-rarity.legendary {
            background: linear-gradient(135deg, rgba(255,170,0,.2), rgba(255,120,0,.2));
            color: #ffaa00;
            border: 1px solid rgba(255,170,0,.3);
            text-shadow: 0 0 8px rgba(255,170,0,.4)
        }
        .tpl-fortnite .item-rarity.epic {
            background: rgba(147,100,255,.15);
            color: #b57aff;
            border: 1px solid rgba(147,100,255,.3)
        }
        .tpl-fortnite .hook { color: #b57aff }
        .tpl-fortnite .price { color: #fff; text-shadow: 0 0 12px rgba(147,100,255,.4) }
        .tpl-fortnite .name { color: #e0d4ff }
        .tpl-fortnite .cta-btn {
            background: linear-gradient(135deg, #7c3aed, #9364ff);
            color: #fff;
            font-weight: 900;
            border-radius: 12px
        }

        /* === v5.3 PRO: Minecraft Style === */
        .tpl-minecraft {
            background: linear-gradient(170deg, #3c2a14 0%, #2a1e0e 40%, #1a1208 100%);
            border: 3px solid #5c4a2a;
            border-radius: 4px !important;
            box-shadow: 4px 4px 0 #1a1208, 0 20px 60px rgba(0,0,0,.7)
        }
        .tpl-minecraft .dirt-overlay {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 16px, rgba(0,0,0,.05) 16px, rgba(0,0,0,.05) 17px), repeating-linear-gradient(90deg, transparent, transparent 16px, rgba(0,0,0,.05) 16px, rgba(0,0,0,.05) 17px);
            pointer-events: none;
            z-index: 1;
            border-radius: 2px
        }
        .tpl-minecraft .craft-label {
            font-size: 9px;
            font-weight: 900;
            color: #a8a8a8;
            text-transform: uppercase;
            letter-spacing: .06em;
            text-shadow: 2px 2px 0 #1a1208;
            font-family: monospace
        }
        .tpl-minecraft .hook { color: #55ff55; text-shadow: 2px 2px 0 rgba(0,0,0,.5); font-family: monospace }
        .tpl-minecraft .name { color: #ffff55; text-shadow: 2px 2px 0 rgba(0,0,0,.5); font-family: monospace }
        .tpl-minecraft .price { color: #55ff55; text-shadow: 2px 2px 0 rgba(0,0,0,.5); font-family: monospace }
        .tpl-minecraft .specs-line { color: #a8a8a8; font-family: monospace; text-shadow: 1px 1px 0 rgba(0,0,0,.4) }
        .tpl-minecraft .cta-btn {
            background: #4a8a2a;
            color: #fff;
            border: 2px solid #5c9e3a;
            border-radius: 2px;
            box-shadow: 2px 2px 0 #2a5a1a;
            text-shadow: 1px 1px 0 rgba(0,0,0,.4);
            font-family: monospace;
            font-weight: 900
        }

        /* === v5.3 PRO: Roblox Style === */
        .tpl-roblox {
            background: linear-gradient(160deg, #1a2744 0%, #0f1a30 40%, #0a1220 100%);
            border: 1px solid rgba(0, 180, 255, .2);
            box-shadow: 0 20px 60px rgba(0,0,0,.6)
        }
        .tpl-roblox .rbx-gradient {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(0,180,255,.06), transparent);
            pointer-events: none;
            z-index: 0;
            border-radius: 18px 18px 0 0
        }
        .tpl-roblox .rbx-badge {
            font-size: 8px;
            font-weight: 900;
            color: #00e676;
            text-transform: uppercase;
            letter-spacing: .08em;
            padding: 3px 8px;
            background: rgba(0,230,118,.1);
            border: 1px solid rgba(0,230,118,.2);
            border-radius: 6px;
            display: inline-block
        }
        .tpl-roblox .hook { color: #00b4ff }
        .tpl-roblox .price { color: #00e676; font-weight: 900 }
        .tpl-roblox .name { color: #e0eaff }
        .tpl-roblox .cta-btn {
            background: linear-gradient(135deg, #00b4ff, #0091ea);
            color: #fff;
            font-weight: 900;
            border-radius: 999px;
            padding: 10px 20px
        }

        /* === v5.3: Enhanced BG States === */
        .bg-controls { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 2px }
        .bg-stats { font-size: 10px; color: var(--muted); padding: 2px 0 }
        .card .product-img.enhanced {
            filter: drop-shadow(0 8px 24px rgba(0,0,0,.5)) drop-shadow(0 2px 8px rgba(0,212,255,.15));
            transition: filter .5s
        }
    </style>
</head>

<body>
    <div class="app">
        <section class="panel">
            <div class="panel-header">
                <img class="logo-img" src="/hellocomp-logo.png" alt="HelloComp"
                    onerror="this.outerHTML='<span style=font-weight:900;font-size:13px>HELLOCOMP</span>'" />
                <span class="version">v5.3 PRO</span>
            </div>

            <div class="section-label">Quick Actions</div>
            <div class="btn-row">
                <button class="btn" id="renderBtn">Generovat</button>
                <button class="btn secondary" id="clearBtn">Vyčistit</button>
                <button class="btn success" id="loadCacheBtn">&#x26A1; Heureka Feed (1051)</button>
                <button class="btn export" id="exportBtn">PNG Export</button>
            </div>

            <div class="section-label">Template Filter</div>
            <div class="template-chips" id="templateChips">
                <span class="chip active" data-tpl="all">Vše</span>
                <span class="chip" data-tpl="hero">Hero</span>
                <span class="chip" data-tpl="split">Split</span>
                <span class="chip" data-tpl="minimal">Minimal</span>
                <span class="chip" data-tpl="neon">Neon</span>
                <span class="chip" data-tpl="specs-focus">Specs</span>
                <span class="chip" data-tpl="csgo" style="border-color:rgba(134,169,82,.3);color:#86a952">CS2</span>
                <span class="chip" data-tpl="lol" style="border-color:rgba(200,170,80,.3);color:#c8aa50">LoL</span>
                <span class="chip" data-tpl="fortnite" style="border-color:rgba(147,100,255,.3);color:#b57aff">Fortnite</span>
                <span class="chip" data-tpl="minecraft" style="border-color:rgba(85,255,85,.2);color:#55ff55">Minecraft</span>
                <span class="chip" data-tpl="roblox" style="border-color:rgba(0,180,255,.3);color:#00b4ff">Roblox</span>
            </div>

            <div class="section-label">Category Filter</div>
            <div class="template-chips" id="categoryChips">
                <span class="chip active" data-cat="all">Vše</span>
                <span class="chip" data-cat="pc">PC (361)</span>
                <span class="chip" data-cat="cpu">CPU (81)</span>
                <span class="chip" data-cat="phone">Mobily (77)</span>
                <span class="chip" data-cat="gpu">GPU (53)</span>
                <span class="chip" data-cat="headset">Sluchátka</span>
                <span class="chip" data-cat="notebook">Notebooky</span>
                <span class="chip" data-cat="peripheral">Periferie</span>
            </div>

            <div class="section-label">Lineup</div>
            <div class="template-chips" id="lineupChips">
                <span class="chip active" data-lineup="all">Vše</span>
                <span class="chip" data-lineup="GAMER SE">SE</span>
                <span class="chip" data-lineup="GAMER Pro">Pro</span>
                <span class="chip" data-lineup="GAMER Max">Max</span>
            </div>

            <div class="section-label">🎯 Smart Background Removal</div>
            <div class="bg-controls">
                <button class="btn small secondary" id="selectAllCardsBtn">☑ Select All</button>
                <button class="btn small secondary" id="deselectAllBtn">☐ Deselect</button>
            </div>
            <div class="btn-row">
                <button class="btn small success" id="removeBgSelectedBtn">🖼️ Remove BG (selected)</button>
                <button class="btn small export" id="preloadModelBtn">⚡ Preload AI</button>
            </div>
            <div id="bgProgress"></div>
            <div class="bg-stats" id="bgStats"></div>

            <div class="section-label">Smart Copy</div>
            <div class="btn-row">
                <button class="btn small secondary" id="generateCopyBtn">🧠 Generovat texty</button>
            </div>

            <div class="status-bar" id="statusText"></div>

            <textarea class="field"
                id="csvInput">id;product_name;hook;price;specs;image_url;image_alt;focal_point;overlay_style;badge_stock;positioning_claim;cta;legal_line;template
1;HelloComp AMD GAMER SE 5700 XT;Výkon bez kompromisů;18 490 Kč;Ryzen 5 5500 / RX 5700 XT / 16GB;https://cdn.myshoptet.com/usr/www.hellocomp.cz/user/shop/orig/5573_1-fotor-20250314181022.png?69091350;HelloComp PC;center;soft;Skladem;Herní počítače pro každého;OBJEDNEJTE TEĎ;Ilustrační foto.;hero
2;HelloComp GAMER MAX DDR5 9070 XT;Posuňte hranice;od 49 990 Kč;Ryzen 7 7700X / RX 9070 XT / 32GB DDR5;https://cdn.myshoptet.com/usr/www.hellocomp.cz/user/shop/orig/5573_1-fotor-20250314181022.png?69091350;HelloComp;center;dark;Skladem;Prémiové sestavy;POSUŇTE HRANICE;Konfigurace se může lišit.;split
3;HelloComp GAMER SE 3060 Ti;Ready to play;19 490 Kč;Ryzen 5 5500 / RTX 3060 Ti / 16GB;https://cdn.myshoptet.com/usr/www.hellocomp.cz/user/shop/orig/5573_1-fotor-20250314181022.png?69091350;HelloComp;center;default;Skladem;Herní počítače;ZAPOJ A HRAJ;Ilustrační foto.;minimal
4;HelloComp GAMER PRO RTX 4070;Nekompromisní gameplay;32 990 Kč;Ryzen 7 5800X / RTX 4070 12GB / 32GB;https://cdn.myshoptet.com/usr/www.hellocomp.cz/user/shop/orig/5573_1-fotor-20250314181022.png?69091350;HelloComp;center;dark;Skladem;Profesionální sestavy;OBJEDNAT;Ilustrační foto.;neon
5;HelloComp GAMER SE RX 6600;Síla v detailech;14 990 Kč;Ryzen 5 3600 / RX 6600 8GB / 16GB;https://cdn.myshoptet.com/usr/www.hellocomp.cz/user/shop/orig/5573_1-fotor-20250314181022.png?69091350;HelloComp;center;soft;Skladem;Herní počítače;DO KOŠÍKU;Ilustrační foto.;specs-focus</textarea>
        </section>
        <main class="preview" id="cardsContainer"></main>
    </div>

    <script>
        /* ===========================
           HelloComp Photo Post Factory v5 FUSION
           Category Intelligence + Futuristic FX + Conversion Engine
           =========================== */

        // ─── Neon template particles ───
        function neonParticles() {
            let html = '';
            for (let i = 0; i < 16; i++) {
                const left = Math.round(Math.random() * 100);
                const dur = 3 + Math.random() * 4;
                const delay = Math.random() * 5;
                const size = 2 + Math.random() * 3;
                const hue = Math.random() > 0.5 ? 'var(--accent)' : 'var(--neon-purple)';
                html += '<div class="particle" style="left:' + left + '%;width:' + size + 'px;height:' + size + 'px;background:' + hue + ';animation-duration:' + dur + 's;animation-delay:' + delay + 's"></div>';
            }
            return html;
        }

        // ─── v5: GPU Brand Detection ───
        function detectGpuBrand(gpuStr) {
            if (!gpuStr) return { brand: 'unknown', series: '', tier: 0 };
            const g = gpuStr.toUpperCase();
            let brand = 'unknown', series = '', tier = 50;
            if (g.includes('RTX 50')) { brand = 'nvidia'; series = 'RTX 50'; tier = 100; }
            else if (g.includes('RTX 40')) { brand = 'nvidia'; series = 'RTX 40'; tier = 90; }
            else if (g.includes('RTX 30')) { brand = 'nvidia'; series = 'RTX 30'; tier = 75; }
            else if (g.includes('RTX 20')) { brand = 'nvidia'; series = 'RTX 20'; tier = 60; }
            else if (g.includes('GTX 16')) { brand = 'nvidia'; series = 'GTX 16'; tier = 45; }
            else if (g.includes('GTX 10')) { brand = 'nvidia'; series = 'GTX 10'; tier = 35; }
            else if (g.includes('RX 9')) { brand = 'amd'; series = 'RX 9000'; tier = 95; }
            else if (g.includes('RX 7')) { brand = 'amd'; series = 'RX 7000'; tier = 85; }
            else if (g.includes('RX 6')) { brand = 'amd'; series = 'RX 6000'; tier = 70; }
            else if (g.includes('RX 5')) { brand = 'amd'; series = 'RX 5000'; tier = 55; }
            else if (g.includes('NVIDIA') || g.includes('GEFORCE') || g.includes('QUADRO')) { brand = 'nvidia'; series = 'NVIDIA'; }
            else if (g.includes('AMD') || g.includes('RADEON')) { brand = 'amd'; series = 'AMD'; }
            return { brand, series, tier };
        }

        // ─── v5: Category Detection (Heureka-aware) ───
        function detectCategory(product) {
            // Heureka JSON has category.slug pre-classified
            if (product.category && product.category.slug) return product.category.slug;
            // Fallback for CSV rows with _category field
            if (product._category) return product._category;
            // Legacy fallback: if has full specs, it's a PC
            const s = product.specs || {};
            if (s.cpu && s.cpu !== 'N/A' && s.gpu && s.gpu !== 'N/A') return 'pc';
            return 'other';
        }

        // ─── v5: Lineup Badge HTML ───
        function lineupBadgeHtml(lineup) {
            if (!lineup) return '';
            const cls = lineup.includes('Max') ? 'max' : lineup.includes('Pro') ? 'pro' : 'se';
            const label = lineup.includes('Max') ? 'GAMER MAX' : lineup.includes('Pro') ? 'GAMER PRO' : 'GAMER SE';
            return '<div class="lineup-badge ' + cls + '">' + label + '</div>';
        }

        // ─── v5: GPU Brand Badge HTML ───
        function gpuBadgeHtml(gpuInfo) {
            if (!gpuInfo || gpuInfo.brand === 'unknown') return '';
            return '<span class="gpu-badge ' + gpuInfo.brand + '">' + gpuInfo.series + '</span>';
        }

        // ─── v5: Urgency pill HTML ───
        function urgencyHtml(product) {
            const stock = product._stock || 0;
            if (stock > 0 && stock <= 5) return '<span class="urgency-pill">Zbývá jen ' + stock + ' ks!</span>';
            if (stock > 5 && stock <= 15) return '<span class="urgency-pill hot">Poslední kusy</span>';
            return '';
        }

        // ─── v5: Social Proof HTML ───
        function socialProofHtml() {
            const proofs = [
                '500+ prodaných tento měsíc',
                'Nejprodávanější sestava',
                'Doporučeno 98% hráčů',
                'Výběr měsíce',
                'Top volba komunity',
                'Ověřeno 200+ recenzemi'
            ];
            return '<div class="social-proof"><span class="dot"></span>' + proofs[Math.floor(Math.random() * proofs.length)] + '</div>';
        }

        // ─── v5: Energy Meter HTML (spec bars) ───
        function energyMeterHtml(specs, gpuInfo) {
            if (!specs || !specs.gpu || specs.gpu === 'N/A') return '';
            const rows = [];
            if (specs.gpu && specs.gpu !== 'N/A') {
                rows.push({ label: 'GPU', cls: 'gpu', value: specs.gpu.substring(0, 28), pct: Math.min(gpuInfo.tier + 5, 100) });
            }
            if (specs.cpu && specs.cpu !== 'N/A') {
                const cpuTier = specs.cpu.toUpperCase().includes('I9') || specs.cpu.toUpperCase().includes('RYZEN 9') ? 90 :
                    specs.cpu.toUpperCase().includes('I7') || specs.cpu.toUpperCase().includes('RYZEN 7') ? 75 :
                        specs.cpu.toUpperCase().includes('I5') || specs.cpu.toUpperCase().includes('RYZEN 5') ? 55 : 40;
                rows.push({ label: 'CPU', cls: 'cpu', value: specs.cpu.substring(0, 28), pct: cpuTier });
            }
            if (specs.ram && specs.ram !== 'N/A') {
                const ramGb = parseInt(specs.ram) || 8;
                const ramPct = Math.min(ramGb * 2.5, 100);
                rows.push({ label: 'RAM', cls: 'ram', value: specs.ram, pct: ramPct });
            }
            if (!rows.length) return '';
            return '<div class="energy-meter">' + rows.map((r, i) =>
                '<div class="energy-row">'
                + '<span class="energy-label">' + r.label + '</span>'
                + '<div class="energy-bar"><div class="energy-fill ' + r.cls + '" style="width:' + r.pct + '%;animation-delay:' + (0.3 + i * 0.15) + 's"></div></div>'
                + '<span class="energy-value">' + r.value + '</span>'
                + '</div>'
            ).join('') + '</div>';
        }

        // ─── Smart Copy Engine (v5 — category aware) ───
        const copyEngine = (function () {
            const hooksByTier = {
                budget: [
                    'GAMING ZA HUBIČKU', 'VÝKON ZA MÁLO', 'LEVNĚ A SILNĚ', 'NEČEKANÝ VÝKON',
                    'VSTUPTE DO HRY', 'READY TO PLAY', 'HRA ZAČÍNÁ', 'POWER ENTRY',
                    'SMART VOLBA', 'BEZ KOMPROMISŮ', 'GAME ON', 'START HERE'
                ],
                mid: [
                    'VÝKON BEZ KOMPROMISŮ', 'POSUŇ HRANICE', 'HERNÍ DOMINANCE', 'TVŮJ NEXT LEVEL',
                    'BUILT TO WIN', 'BEYOND LIMITS', 'POWER UPGRADE', 'SERIOUS GAMING',
                    'PRO KAŽDÝ FRAME', 'UNLEASH POWER', 'LEVEL UP NOW', 'GAME CHANGER'
                ],
                premium: [
                    'NEKOMPROMISNÍ SÍLA', 'ABSOLUTNÍ VÝKON', 'TOP TIER GAMING', 'PURE PERFORMANCE',
                    'MAXED OUT', 'ELITE LEVEL', 'ZERO COMPROMISE', 'FUTURE PROOF',
                    'ULTIMATE SETUP', 'POWERHOUSE', 'RAW POWER', 'BEAST INSIDE'
                ],
                ultra: [
                    'LIMITLESS POWER', 'APEX PERFORMANCE', 'EXTREME MACHINE', 'THE ONE',
                    'SUPREMACY', 'NO LIMITS', 'GODLIKE SETUP', 'BEAST MODE ON',
                    'FLAGSHIP KILLER', 'DREAM BUILD', 'MAX EVERYTHING', 'UNSTOPPABLE'
                ]
            };

            const hooksByCategory = {
                gpu: ['UPGRADE SVŮJ RIG', 'GRAFICKÝ SKOK', 'NOVÁ GRAFIKA', 'FPS BOOST', 'VISUAL POWER', 'NEXT GEN GPU'],
                notebook: ['GAMING ON THE GO', 'MOBILNÍ SÍLA', 'VEZMI SI VÝKON', 'HRAJ KDEKOLIV', 'PORTABLE BEAST'],
                cpu: ['SRDCE SESTAVY', 'CORE UPGRADE', 'NOVÝ PROCESOR', 'RAW COMPUTE', 'MULTI-THREAD BEAST'],
                phone: ['SMART VOLBA', 'TVŮJ NOVÝ TELEFON', 'ALWAYS CONNECTED', 'VÝKON V KAPSE', 'FLAGSHIP LEVEL'],
                headset: ['SLYŠ KAŽDÝ DETAIL', 'ZVUKOVÁ DOMINANCE', 'IMMERSIVE AUDIO', 'HEAR THE GAME'],
                monitor: ['FULL IMMERSION', 'CRYSTAL CLEAR', 'PIXEL PERFECT', 'VIZUÁLNÍ UPGRADE'],
                peripheral: ['CONTROL FREAK', 'PŘESNOST V RUKÁCH', 'PRO SETUP', 'GAME GEAR'],
                case: ['BYDLENÍ PRO PC', 'STYLE & AIRFLOW', 'DREAM CHASSIS'],
                cooler: ['KEEP IT COOL', 'ZERO THROTTLE', 'ICE COLD TEMPS'],
                psu: ['STABILNÍ NAPÁJENÍ', 'POWER BACKBONE', 'ENERGY CORE'],
                ram: ['MEMORY BOOST', 'RYCHLOST PAMĚTI', 'ZERO LAG'],
                storage: ['BLESKOVÉ ÚLOŽIŠTĚ', 'ZERO LOAD TIMES', 'SSD POWER']
            };

            const claimsByTier = {
                budget: ['Herní PC pro každého', 'Vstupní brána do gamingu', 'Smart gaming volba', 'Ověřený výkon za rozumnou cenu'],
                mid: ['Herní sestava nové generace', 'Pro náročné hráče', 'Výkon, který překvapí', 'Sestaveno pro výhry'],
                premium: ['Profesionální herní platforma', 'Pro streamery a profíky', 'Nekompromisní herní zážitek', 'Elite gaming řešení'],
                ultra: ['Absolutní špička v gamingu', 'Ta nejlepší sestava na trhu', 'Exkluzivní herní platforma', 'Dream build realitou']
            };

            const ctaPool = ['OBJEDNAT TEĎ', 'DO KOŠÍKU', 'CHCI TO', 'KOUPIT', 'ZJISTIT VÍCE', 'VYBRAT KONFIGURACI', 'PROZKOUMAT', 'NAKONFIGUROVAT', 'ZÍSKAT TEĎ', 'MÁM ZÁJEM'];

            const used = { hooks: new Set(), claims: new Set(), ctas: new Set() };

            function pickUnique(arr, usedSet) {
                const available = arr.filter(x => !usedSet.has(x));
                const pool = available.length > 0 ? available : arr;
                const pick = pool[Math.floor(Math.random() * pool.length)];
                usedSet.add(pick);
                return pick;
            }

            function getTier(priceStr) {
                const n = parseInt(String(priceStr).replace(/[^\d]/g, ''), 10);
                if (isNaN(n) || n < 17000) return 'budget';
                if (n < 30000) return 'mid';
                if (n < 50000) return 'premium';
                return 'ultra';
            }

            function generate(priceStr, category) {
                const tier = getTier(priceStr);
                let hookPool = [...hooksByTier[tier]];
                // Mix in category-specific hooks
                if (category && hooksByCategory[category]) {
                    hookPool = hookPool.concat(hooksByCategory[category]);
                }
                return {
                    hook: pickUnique(hookPool, used.hooks),
                    claim: pickUnique(claimsByTier[tier], used.claims),
                    cta: pickUnique(ctaPool, used.ctas),
                    tier
                };
            }

            function reset() { used.hooks.clear(); used.claims.clear(); used.ctas.clear(); }

            return { generate, reset, getTier };
        })();

        // ─── Logo helper ───
        function logoHtml(dark) {
            const filter = dark ? '' : 'filter:brightness(0) invert(1);';
            return '<img class="logo-watermark" src="/hellocomp-logo.png" alt="HC" style="' + filter + '" onerror="this.outerHTML=\'<span style=font-weight:900;font-size:11px;opacity:.6>HELLOCOMP</span>\'">';
        }

        // ─── Parse specs ───
        function parseSpecs(specsStr) {
            if (!specsStr) return { cpu: '', gpu: '', ram: '', items: [] };
            const parts = specsStr.split('/').map(s => s.trim());
            return {
                cpu: parts[0] || '',
                gpu: parts[1] || '',
                ram: parts[2] || '',
                items: parts
            };
        }

        // ─── v5: Format price for display ───
        function formatPrice(price) {
            if (!price && price !== 0) return '0 Kč';
            const n = typeof price === 'number' ? price : parseInt(String(price).replace(/[^\d]/g, ''));
            if (isNaN(n)) return price;
            return n.toLocaleString('cs-CZ') + ' Kč';
        }

        // ─── Template Renderers (v5 FUSION) ───
        const templates = {
            hero(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const isPremium = gpu.tier >= 75;
                const cls = 'card tpl-hero cyber-grid scanner-line' + (isPremium ? ' holo-shimmer' : '');
                return '<div class="' + cls + '" data-tpl="hero" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="data-stream"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">HERO</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">&#215;</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + gpuBadgeHtml(gpu) + '<span class="stock-pill">' + (p.badge_stock || 'SKLADEM') + '</span></div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + socialProofHtml()
                    + '<div class="price-row"><div class="price">' + p.price + '</div>' + urgencyHtml(p) + '</div>'
                    + '<div class="cta-btn">' + (p.cta || 'OBJEDNAT') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            split(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const specTags = s.items.map(i => '<span class="spec-tag">' + i + '</span>').join('');
                return '<div class="card tpl-split" data-tpl="split" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">SPLIT</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">&#215;</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(true) + gpuBadgeHtml(gpu) + '<span class="stock-pill">' + (p.badge_stock || 'SKLADEM') + '</span></div>'
                    + '<div class="divider"></div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-grid">' + specTags + '</div>'
                    + '<div class="price-row"><div class="price">' + p.price + '</div>' + urgencyHtml(p) + '</div>'
                    + '<div class="cta-btn">' + (p.cta || 'OBJEDNAT') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            minimal(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                return '<div class="card tpl-minimal" data-tpl="minimal" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">MINIMAL</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">&#215;</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(true) + gpuBadgeHtml(gpu) + '<span class="stock-tag">' + (p.badge_stock || 'SKLADEM') + '</span></div>'
                    + '<div class="claim">' + (p.positioning_claim || '') + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + '<div class="price-row"><div class="price">' + p.price + '</div></div>'
                    + '<div class="cta-btn">' + (p.cta || 'OBJEDNAT') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            neon(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const specsObj = { cpu: s.cpu, gpu: s.gpu, ram: s.ram, storage: s.items[3] || '' };
                return '<div class="card tpl-neon cyber-grid scanner-line holo-shimmer" data-tpl="neon" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="data-stream"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">NEON</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">&#215;</button>'
                    + '<div class="glow-ring"></div>'
                    + '<div class="particles">' + neonParticles() + '</div>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + gpuBadgeHtml(gpu) + '<span class="stock-pill">' + (p.badge_stock || 'SKLADEM') + '</span></div>'
                    + '<div class="claim">' + (p.positioning_claim || 'ELITE GAMING') + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + energyMeterHtml(specsObj, gpu)
                    + socialProofHtml()
                    + '<div class="price">' + p.price + '</div>'
                    + urgencyHtml(p)
                    + '<div class="cta-btn">' + (p.cta || 'OBJEDNAT') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            'specs-focus'(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const specsObj = { cpu: s.cpu, gpu: s.gpu, ram: s.ram, storage: s.items[3] || '' };
                const specRows = [
                    { icon: '\u26A1', label: 'PROCESOR', value: s.cpu },
                    { icon: '\uD83C\uDFAE', label: 'GRAFIKA', value: s.gpu },
                    { icon: '\uD83D\uDCBE', label: 'PAMĚŤ', value: s.ram }
                ].filter(r => r.value).map(r =>
                    '<div class="spec-row">'
                    + '<div class="spec-icon">' + r.icon + '</div>'
                    + '<div><div class="spec-label">' + r.label + '</div><div class="spec-value">' + r.value + '</div></div>'
                    + '</div>'
                ).join('');
                return '<div class="card tpl-specs cyber-grid" data-tpl="specs-focus" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="data-stream"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">SPECS</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">&#215;</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + gpuBadgeHtml(gpu) + '<span class="stock-pill">' + (p.badge_stock || 'SKLADEM') + '</span></div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-table">' + specRows + '</div>'
                    + energyMeterHtml(specsObj, gpu)
                    + '<div class="price-row"><div class="price">' + p.price + '</div>' + urgencyHtml(p) + '</div>'
                    + '<div class="cta-btn">' + (p.cta || 'OBJEDNAT') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            // ─── v5.3 PRO: CS2 (Counter-Strike 2) Template ───
            csgo(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const n = parseInt(String(p.price).replace(/[^\d]/g, ''), 10) || 0;
                const rar = n >= 40000 ? 'covert' : n >= 25000 ? 'classified' : 'restricted';
                const rLbl = rar === 'covert' ? '\u2605 COVERT' : rar === 'classified' ? 'CLASSIFIED' : 'RESTRICTED';
                const specsObj = { cpu: s.cpu, gpu: s.gpu, ram: s.ram };
                return '<div class="card tpl-csgo" data-tpl="csgo" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">CS2</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">\u00d7</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + '<span class="wear-tag">' + rLbl + '</span>' + gpuBadgeHtml(gpu) + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + energyMeterHtml(specsObj, gpu)
                    + '<div class="price-row"><div class="price">' + p.price + '</div>' + urgencyHtml(p) + '</div>'
                    + '<div class="cta-btn">' + (p.cta || 'INSPECT') + '</div>'
                    + '</div>'
                    + '<div class="rarity-stripe ' + rar + '"></div>'
                    + '</div>';
            },

            // ─── v5.3 PRO: League of Legends Template ───
            lol(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const n = parseInt(String(p.price).replace(/[^\d]/g, ''), 10) || 0;
                const rank = n >= 50000 ? 'CHALLENGER' : n >= 35000 ? 'MASTER' : n >= 20000 ? 'DIAMOND' : 'PLATINUM';
                const specsObj = { cpu: s.cpu, gpu: s.gpu, ram: s.ram };
                return '<div class="card tpl-lol" data-tpl="lol" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="rank-frame"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">LOL</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">\u00d7</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + '<span class="rank-tag">' + rank + '</span>' + gpuBadgeHtml(gpu) + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + energyMeterHtml(specsObj, gpu)
                    + socialProofHtml()
                    + '<div class="price-row"><div class="price">' + p.price + '</div>' + urgencyHtml(p) + '</div>'
                    + '<div class="cta-btn">' + (p.cta || 'SUMMONER\'S CHOICE') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            // ─── v5.3 PRO: Fortnite Template ───
            fortnite(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                const n = parseInt(String(p.price).replace(/[^\d]/g, ''), 10) || 0;
                const isLegendary = n >= 30000;
                const rarCls = isLegendary ? 'legendary' : 'epic';
                const rarLbl = isLegendary ? 'LEGENDARY' : 'EPIC';
                return '<div class="card tpl-fortnite" data-tpl="fortnite" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="diagonal-stripes"></div>'
                    + '<div class="rarity-glow"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">FORTNITE</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">\u00d7</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + '<span class="item-rarity ' + rarCls + '">' + rarLbl + '</span>' + gpuBadgeHtml(gpu) + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + '<div class="price-row"><div class="price">' + p.price + '</div>' + urgencyHtml(p) + '</div>'
                    + '<div class="cta-btn">' + (p.cta || 'GET IT NOW') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            // ─── v5.3 PRO: Minecraft Template ───
            minecraft(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                return '<div class="card tpl-minecraft" data-tpl="minecraft" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="dirt-overlay"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label" style="font-family:monospace">CRAFT</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">\u00d7</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + '<span class="craft-label">[CRAFTED]</span>' + gpuBadgeHtml(gpu) + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + '<div class="price-row"><div class="price">' + p.price + '</div></div>'
                    + '<div class="cta-btn">' + (p.cta || 'MINE IT') + '</div>'
                    + '</div>'
                    + '</div>';
            },

            // ─── v5.3 PRO: Roblox Template ───
            roblox(p) {
                const s = parseSpecs(p.specs);
                const gpu = detectGpuBrand(s.gpu || p._gpuRaw);
                return '<div class="card tpl-roblox" data-tpl="roblox" data-cat="' + (p._category || '') + '" data-lineup="' + (p._lineup || '') + '">'
                    + '<div class="rbx-gradient"></div>'
                    + lineupBadgeHtml(p._lineup)
                    + '<span class="template-label">ROBLOX</span>'
                    + '<button class="remove-btn" onclick="this.closest(\'.card\').remove();updateCount()">\u00d7</button>'
                    + '<div class="product-zone"><img class="product-img" src="' + p.image_url + '" alt="' + (p.image_alt || p.product_name) + '"/></div>'
                    + '<div class="content">'
                    + '<div class="logo-row">' + logoHtml(false) + '<span class="rbx-badge">\u2B50 PREMIUM</span>' + gpuBadgeHtml(gpu) + '</div>'
                    + '<div class="hook">' + p.hook + '</div>'
                    + '<div class="name">' + p.product_name + '</div>'
                    + '<div class="specs-line">' + p.specs + '</div>'
                    + socialProofHtml()
                    + '<div class="price-row"><div class="price">' + p.price + '</div></div>'
                    + '<div class="cta-btn">' + (p.cta || 'PLAY NOW') + '</div>'
                    + '</div>'
                    + '</div>';
            }
        };

        // ─── CSV Parser ───
        function parseCSV(csv) {
            const lines = csv.trim().split('\n').filter(l => l.trim());
            if (lines.length < 2) return [];
            const headers = lines[0].split(';').map(h => h.trim());
            return lines.slice(1).map(line => {
                const vals = line.split(';');
                const obj = {};
                headers.forEach((h, i) => { obj[h] = vals[i] ? vals[i].trim() : '' });
                return obj;
            });
        }

        // ─── State ───
        let currentFilter = 'all';
        let currentCategory = 'all';
        let currentLineup = 'all';
        let cachedProducts = []; // v5: holds JSON cache data
        let bgRemovalModule = null; // @imgly/background-removal (loaded on demand)

        // ─── Render cards ───
        function renderCards() {
            const csv = document.getElementById('csvInput').value;
            const products = parseCSV(csv);
            if (!products.length) { setStatus('Žádné produkty v CSV.', '#f87171'); return; }
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            const templateKeys = Object.keys(templates);
            let rendered = 0;

            products.forEach((p, i) => {
                let tpl = (p.template || '').trim().toLowerCase();
                if (!templates[tpl]) tpl = templateKeys[i % templateKeys.length];
                if (currentFilter !== 'all' && tpl !== currentFilter) return;
                if (currentCategory !== 'all' && p._category !== currentCategory) return;
                if (currentLineup !== 'all' && p._lineup !== currentLineup) return;
                const html = templates[tpl](p);
                container.insertAdjacentHTML('beforeend', html);
                rendered++;
            });

            // Count bar with category + lineup info
            const catLabel = currentCategory === 'all' ? 'vše' : currentCategory;
            const lineLabel = currentLineup === 'all' ? 'vše' : currentLineup;
            const countBar = '<div class="preview-count">'
                + '<strong>' + rendered + ' karet</strong>'
                + '<span>|</span><span>tpl: ' + currentFilter + '</span>'
                + '<span>|</span><span>kat: ' + catLabel + '</span>'
                + '<span>|</span><span>řada: ' + lineLabel + '</span>'
                + '</div>';
            container.insertAdjacentHTML('afterbegin', countBar);

            // Stagger card entrance animations
            container.querySelectorAll('.card').forEach((card, idx) => {
                card.style.animationDelay = (idx * 0.08) + 's';
            });

            // Stagger energy bar animations
            container.querySelectorAll('.energy-fill').forEach((bar, idx) => {
                const baseDelay = parseFloat(bar.style.animationDelay) || 0.3;
                bar.style.animationDelay = (baseDelay + Math.floor(idx / 3) * 0.2) + 's';
            });

            // Inject per-card controls (BG button + selection check)
            container.querySelectorAll('.card').forEach(card => {
                const btn = document.createElement('button');
                btn.className = 'remove-btn bg-btn';
                btn.textContent = 'BG';
                btn.title = 'Odstranit pozadí (AI)';
                btn.onclick = function (e) { e.stopPropagation(); removeBgCard(card.querySelector('.product-img'), btn); };
                card.appendChild(btn);
                // Selection check circle
                const chk = document.createElement('div');
                chk.className = 'select-check';
                chk.textContent = '\u2713';
                card.appendChild(chk);
            });

            setStatus('Vygenerováno ' + rendered + ' karet. v5.3 PRO ready.', '#34d399');
            updateBgStats();
        }

        function updateCount() {
            const cards = document.querySelectorAll('.card');
            const bar = document.querySelector('.preview-count');
            if (bar) bar.querySelector('strong').textContent = cards.length + ' karet';
        }

        function setStatus(msg, color) {
            const el = document.getElementById('statusText');
            el.textContent = msg;
            el.style.color = color || 'var(--muted)';
        }

        // ─── v5: Load products from Heureka JSON ───
        async function loadFromCache() {
            setStatus('Načítám Heureka produktový feed...', 'var(--accent)');
            try {
                // Primary: Heureka JSON (converted from XML feed)
                let data;
                const res = await fetch('/data/heureka-products.json');
                if (res.ok) {
                    data = await res.json();
                } else {
                    // Fallback: old cache
                    const res2 = await fetch('/data/products-cache.json');
                    if (!res2.ok) throw new Error('Nelze načíst feed: HTTP ' + res2.status);
                    data = await res2.json();
                }
                const allProducts = data.products || [];
                const meta = data.meta || {};
                // Filter: must have price > 50 and image
                const viable = allProducts.filter(p => p.price && p.price > 50 && p.img);
                cachedProducts = viable;

                // Smart selection: diverse mix across categories and price tiers
                const selected = smartSelectProducts(viable, 30);

                // Build CSV from selected Heureka products
                const headers = 'id;product_name;hook;price;specs;image_url;image_alt;focal_point;overlay_style;badge_stock;positioning_claim;cta;template;_category;_lineup;_gpuRaw;_stock';
                const tierTemplates = {
                    budget: ['minimal', 'split', 'specs-focus', 'roblox', 'minecraft'],
                    mid: ['split', 'hero', 'minimal', 'csgo', 'minecraft'],
                    premium: ['hero', 'neon', 'fortnite', 'lol', 'csgo'],
                    ultra: ['neon', 'fortnite', 'lol', 'csgo', 'hero']
                };
                const tierCounters = { budget: 0, mid: 0, premium: 0, ultra: 0 };
                copyEngine.reset();

                const lines = selected.map(p => {
                    const category = detectCategory(p);
                    const gpu = (p.specs && p.specs.gpu) ? p.specs.gpu : '';
                    const gpuInfo = detectGpuBrand(gpu);
                    const priceStr = p.priceFormatted || formatPrice(p.price);
                    const tier = copyEngine.getTier(String(p.price));
                    const copy = copyEngine.generate(String(p.price), category);
                    const pool = tierTemplates[tier];
                    const tpl = pool[tierCounters[tier] % pool.length];
                    tierCounters[tier]++;

                    // Build specs line from Heureka structured specs
                    const s = p.specs || {};
                    const specsLine = [s.cpu, s.gpu, s.ram].filter(x => x).join(' / ');

                    return [
                        p.id,
                        p.name || '',
                        copy.hook,
                        priceStr,
                        specsLine,
                        p.img,
                        p.name || '',
                        'center',
                        'dark',
                        p.inStock ? 'Skladem' : 'Na objednávku',
                        copy.claim,
                        copy.cta,
                        tpl,
                        category,
                        p.lineup || '',
                        gpu || '',
                        p.inStock ? '1' : '0'
                    ].join(';');
                });

                document.getElementById('csvInput').value = headers + '\n' + lines.join('\n');
                const src = meta.source === 'heureka' ? 'Heureka feed' : 'cache';
                setStatus('Načteno ' + selected.length + ' produktů z ' + src + ' (' + viable.length + '/' + (meta.totalProducts || allProducts.length) + ' celkem). Klikni Generovat!', '#34d399');
            } catch (e) {
                setStatus('Chyba: ' + e.message, '#f87171');
                console.error(e);
            }
        }

        // ─── v5: Smart Product Selection (Heureka-aware) ───
        function smartSelectProducts(products, count) {
            // Group by Heureka category slug
            const byCategory = {};
            products.forEach(p => {
                const cat = detectCategory(p);
                if (!byCategory[cat]) byCategory[cat] = [];
                byCategory[cat].push(p);
            });

            // Priority weights: high-margin categories get more slots
            const priorityCats = ['pc', 'gpu', 'notebook', 'cpu', 'phone', 'headset', 'monitor', 'case', 'psu', 'mobo', 'cooler', 'ram', 'storage', 'peripheral'];
            const selected = [];
            const targetRatios = { pc: 0.35, gpu: 0.12, notebook: 0.1, cpu: 0.08, phone: 0.08, headset: 0.06, monitor: 0.04 };

            // Fill priority categories first
            for (const cat of priorityCats) {
                const target = Math.max(1, Math.ceil(count * (targetRatios[cat] || 0.02)));
                const pool = byCategory[cat] || [];
                if (!pool.length) continue;
                pool.sort((a, b) => (b.price || 0) - (a.price || 0));
                const step = Math.max(1, Math.floor(pool.length / target));
                for (let i = 0; i < Math.min(target, pool.length); i++) {
                    const idx = Math.min(i * step, pool.length - 1);
                    if (!selected.find(s => s.id === pool[idx].id)) {
                        selected.push(pool[idx]);
                    }
                    if (selected.length >= count) break;
                }
                if (selected.length >= count) break;
            }

            // Fill remaining slots with highest-priced unselected from any category
            if (selected.length < count) {
                const remaining = products
                    .filter(p => !selected.find(s => s.id === p.id))
                    .sort((a, b) => (b.price || 0) - (a.price || 0));
                while (selected.length < count && remaining.length) {
                    selected.push(remaining.shift());
                }
            }

            return selected.slice(0, count);
        }

        // ─── Legacy: Load from CSV file ───
        async function loadProducts() {
            setStatus('Načítám produkty z CSV...', 'var(--accent)');
            try {
                const res = await fetch('/products-all.csv');
                if (!res.ok) throw new Error('HTTP ' + res.status);
                const text = await res.text();
                const lines = text.trim().split('\n');
                if (lines.length < 2) { setStatus('CSV prázdné.', '#f87171'); return; }
                const headers = lines[0].split(';').map(h => h.trim());
                const tierTemplates = {
                    budget: ['minimal', 'split', 'specs-focus', 'roblox', 'minecraft'],
                    mid: ['split', 'hero', 'minimal', 'csgo', 'minecraft'],
                    premium: ['hero', 'neon', 'fortnite', 'lol', 'csgo'],
                    ultra: ['neon', 'fortnite', 'lol', 'csgo', 'hero']
                };
                const tierCounters = { budget: 0, mid: 0, premium: 0, ultra: 0 };
                const priceColIdx = headers.indexOf('price');
                const newLines = [lines[0]];
                for (let i = 1; i < lines.length; i++) {
                    const vals = lines[i].split(';');
                    const tplIdx = headers.indexOf('template');
                    const price = priceColIdx >= 0 ? vals[priceColIdx] : '0';
                    const tier = copyEngine.getTier(price);
                    const pool = tierTemplates[tier];
                    if (tplIdx >= 0) vals[tplIdx] = pool[tierCounters[tier] % pool.length];
                    tierCounters[tier]++;
                    newLines.push(vals.join(';'));
                }
                document.getElementById('csvInput').value = newLines.join('\n');
                setStatus('Načteno ' + (lines.length - 1) + ' produktů z CSV.', '#34d399');
            } catch (e) {
                setStatus('Chyba: ' + e.message, '#f87171');
            }
        }

        // ─── Smart Copy: regenerate all hooks/claims/CTAs ───
        function generateSmartCopy() {
            copyEngine.reset();
            const csv = document.getElementById('csvInput').value;
            const lines = csv.trim().split('\n');
            if (lines.length < 2) return;
            const headers = lines[0].split(';').map(h => h.trim());
            const hookIdx = headers.indexOf('hook');
            const ctaIdx = headers.indexOf('cta');
            const claimIdx = headers.indexOf('positioning_claim');
            const priceIdx = headers.indexOf('price');
            const catIdx = headers.indexOf('_category');

            const newLines = [lines[0]];
            for (let i = 1; i < lines.length; i++) {
                const vals = lines[i].split(';');
                const price = priceIdx >= 0 ? vals[priceIdx] : '0';
                const cat = catIdx >= 0 ? vals[catIdx] : '';
                const gen = copyEngine.generate(price, cat);
                if (hookIdx >= 0) vals[hookIdx] = gen.hook;
                if (ctaIdx >= 0) vals[ctaIdx] = gen.cta;
                if (claimIdx >= 0) vals[claimIdx] = gen.claim;
                newLines.push(vals.join(';'));
            }
            document.getElementById('csvInput').value = newLines.join('\n');
            setStatus('Smart Copy vygenerován pro ' + String(lines.length - 1) + ' produktů.', '#34d399');
        }

        // ─── AI Background Removal (@imgly/background-removal — runs 100% in browser) ───
        async function loadBgRemovalEngine() {
            if (bgRemovalModule) return bgRemovalModule;
            setStatus('Načítám AI model pro odstranění pozadí (~40 MB, jen poprvé)...', 'var(--accent)');
            const preloadBtn = document.getElementById('preloadModelBtn');
            if (preloadBtn) { preloadBtn.textContent = '⏳ Loading...'; preloadBtn.style.pointerEvents = 'none'; }
            try {
                bgRemovalModule = await import('https://esm.sh/@imgly/background-removal@1.5.15');
                setStatus('AI model načten. Připraveno!', '#34d399');
                if (preloadBtn) { preloadBtn.textContent = '✅ AI Ready'; preloadBtn.className = 'btn small success'; }
                return bgRemovalModule;
            } catch (e) {
                setStatus('Chyba AI modelu: ' + e.message, '#f87171');
                if (preloadBtn) { preloadBtn.textContent = '⚡ Preload AI'; preloadBtn.style.pointerEvents = ''; }
                throw e;
            }
        }

        async function fetchImageBlob(src) {
            try {
                const r = await fetch(src, { mode: 'cors' });
                if (r.ok) return await r.blob();
            } catch (_) {}
            try {
                const r = await fetch('/api/proxy-image?url=' + encodeURIComponent(src));
                if (r.ok) return await r.blob();
            } catch (_) {}
            throw new Error('Nelze načíst obrázek: ' + src.substring(0, 60));
        }

        // ─── Post-process: enhance cutout image ───
        function enhanceImage(img) {
            img.classList.add('bg-removed', 'enhanced');
        }

        // ─── Per-card BG removal ───
        async function removeBgCard(img, btn) {
            if (!img) return;
            if (img.dataset.bgRemoved) {
                setStatus('Pozadí již odstraněno.', 'var(--muted)');
                return;
            }
            btn.textContent = '⏳';
            btn.className = 'remove-btn bg-btn working';
            setStatus('Odstraňuji pozadí...', 'var(--accent)');
            try {
                const mod = await loadBgRemovalEngine();
                const imageBlob = await fetchImageBlob(img.src);
                const resultBlob = await mod.removeBackground(imageBlob, {
                    output: { format: 'image/png' }
                });
                img.src = URL.createObjectURL(resultBlob);
                img.dataset.bgRemoved = '1';
                enhanceImage(img);
                btn.className = 'remove-btn bg-btn done';
                btn.textContent = '✓';
                setStatus('Pozadí odstraněno + obrázek vylepšen!', '#34d399');
                updateBgStats();
            } catch (e) {
                btn.className = 'remove-btn bg-btn';
                btn.textContent = 'BG';
                setStatus('Chyba: ' + e.message, '#f87171');
                console.error('BG removal error:', e);
            }
        }

        // ─── Selection helpers ───
        function selectAllCards() {
            document.querySelectorAll('.card').forEach(c => c.classList.add('selected'));
            updateBgStats();
        }
        function deselectAllCards() {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            updateBgStats();
        }
        function updateBgStats() {
            const all = document.querySelectorAll('.card').length;
            const sel = document.querySelectorAll('.card.selected').length;
            const done = document.querySelectorAll('.card .product-img.bg-removed').length;
            const el = document.getElementById('bgStats');
            if (el) el.innerHTML = '<span>' + sel + ' selected</span> ・ <span style="color:#34d399">' + done + ' processed</span> ・ <span>' + all + ' total</span>';
        }

        // ─── Preload AI model ───
        async function preloadModel() {
            try { await loadBgRemovalEngine(); } catch (_) {}
        }

        // ─── Batch BG removal: process SELECTED cards with progress ───
        async function removeBackgroundSelected() {
            const selectedCards = Array.from(document.querySelectorAll('.card.selected'));
            const unprocessed = selectedCards.filter(c => {
                const img = c.querySelector('.product-img');
                return img && !img.dataset.bgRemoved;
            });
            if (!selectedCards.length) {
                setStatus('Nejdřív vyber karty kliknutím. Pak klikni Remove BG.', '#f87171');
                return;
            }
            if (!unprocessed.length) {
                setStatus('Všechny vybrané obrázky již zpracovány.', 'var(--muted)');
                return;
            }
            try {
                await loadBgRemovalEngine();
            } catch (_) { return; }

            let done = 0;
            let failed = 0;
            const total = unprocessed.length;
            const progressEl = document.getElementById('bgProgress');
            const startTime = Date.now();
            function updateProgress() {
                const pct = Math.round((done / total) * 100);
                const elapsed = (Date.now() - startTime) / 1000;
                const perItem = done > 0 ? elapsed / done : 0;
                const remaining = Math.round(perItem * (total - done));
                const eta = done > 0 && done < total ? ' ・ ~' + remaining + 's left' : '';
                progressEl.innerHTML = '<div class="bg-progress"><span>' + done + '/' + total + (failed ? ' (' + failed + ' err)' : '') + '</span>'
                    + '<div class="bar"><div class="bar-fill" style="width:' + pct + '%"></div></div>'
                    + '<span>' + pct + '%' + eta + '</span></div>';
                setStatus('BG removal: ' + done + '/' + total + '...' + eta, 'var(--accent)');
            }
            updateProgress();

            for (const card of unprocessed) {
                const img = card.querySelector('.product-img');
                const btn = card.querySelector('.bg-btn');
                if (btn) { btn.textContent = '⏳'; btn.className = 'remove-btn bg-btn working'; }
                try {
                    const imageBlob = await fetchImageBlob(img.src);
                    const resultBlob = await bgRemovalModule.removeBackground(imageBlob, {
                        output: { format: 'image/png' }
                    });
                    img.src = URL.createObjectURL(resultBlob);
                    img.dataset.bgRemoved = '1';
                    enhanceImage(img);
                    if (btn) { btn.className = 'remove-btn bg-btn done'; btn.textContent = '✓'; }
                    done++;
                } catch (e) {
                    if (btn) { btn.className = 'remove-btn bg-btn'; btn.textContent = '✗'; }
                    console.error('BG fail:', e);
                    failed++;
                    done++;
                }
                updateProgress();
                updateBgStats();
            }
            progressEl.innerHTML = '';
            const successCount = total - failed;
            setStatus('Hotovo: ' + successCount + '/' + total + ' obrázků zpracováno a vylepšeno.' + (failed ? ' (' + failed + ' chyb)' : ' ✅'), '#34d399');
        }

        // ─── Card selection (click to toggle) ───
        document.getElementById('cardsContainer').addEventListener('click', function (e) {
            if (e.target.closest('.remove-btn') || e.target.closest('.cta-btn')) return;
            const card = e.target.closest('.card');
            if (!card) return;
            card.classList.toggle('selected');
            updateBgStats();
        });

        // ─── Template filter chips ───
        document.getElementById('templateChips').addEventListener('click', function (e) {
            if (!e.target.classList.contains('chip')) return;
            this.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            currentFilter = e.target.dataset.tpl;
            renderCards();
        });

        // ─── v5: Category filter chips ───
        document.getElementById('categoryChips').addEventListener('click', function (e) {
            if (!e.target.classList.contains('chip')) return;
            this.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            currentCategory = e.target.dataset.cat;
            renderCards();
        });

        // ─── v5: Lineup filter chips ───
        document.getElementById('lineupChips').addEventListener('click', function (e) {
            if (!e.target.classList.contains('chip')) return;
            this.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            currentLineup = e.target.dataset.lineup;
            renderCards();
        });

        // ─── Button bindings ───
        document.getElementById('renderBtn').addEventListener('click', renderCards);
        document.getElementById('clearBtn').addEventListener('click', function () {
            document.getElementById('cardsContainer').innerHTML = '';
            setStatus('Vyčištěno.', 'var(--muted)');
        });
        document.getElementById('loadCacheBtn').addEventListener('click', loadFromCache);
        document.getElementById('generateCopyBtn').addEventListener('click', function () {
            generateSmartCopy();
            renderCards();
        });
        document.getElementById('removeBgSelectedBtn').addEventListener('click', removeBackgroundSelected);
        document.getElementById('selectAllCardsBtn').addEventListener('click', selectAllCards);
        document.getElementById('deselectAllBtn').addEventListener('click', deselectAllCards);
        document.getElementById('preloadModelBtn').addEventListener('click', preloadModel);
        document.getElementById('exportBtn').addEventListener('click', exportCards);

        // ─── PNG Export (html2canvas) ───
        async function exportCards() {
            const cards = document.querySelectorAll('.card');
            if (!cards.length) { setStatus('Nejdřív vygeneruj karty.', '#f87171'); return; }

            if (typeof html2canvas === 'undefined') {
                setStatus('Načítám export engine...', 'var(--accent)');
                await new Promise((resolve, reject) => {
                    const s = document.createElement('script');
                    s.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    s.onload = resolve;
                    s.onerror = reject;
                    document.head.appendChild(s);
                });
            }

            setStatus('Exportuji ' + cards.length + ' karet jako PNG...', 'var(--accent)');
            let done = 0;

            for (const card of cards) {
                try {
                    card.style.animation = 'none';
                    card.querySelectorAll('*').forEach(el => { el.style.animation = 'none'; });

                    const canvas = await html2canvas(card, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: null,
                        logging: false
                    });

                    const link = document.createElement('a');
                    link.download = 'hellocomp-' + (card.dataset.tpl || 'card') + '-' + (done + 1) + '.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    done++;
                    setStatus('Export: ' + done + '/' + cards.length + '...', 'var(--accent)');
                } catch (e) {
                    console.error('Export error:', e);
                }
            }

            renderCards();
            setStatus('Exportováno ' + done + ' karet jako PNG!', '#34d399');
        }

        // ─── Auto-render on load ───
        window.addEventListener('DOMContentLoaded', renderCards);
    </script>

</body>

</html>